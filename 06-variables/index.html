<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2017-01-30 00:03:01 +0100">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="/swc-releases/1999.12/make-novice">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon-swc.ico" />
    
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Automation and Make: Variables</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

	
        
        <li><a href="../setup/">Setup</a></li>
        <li><a href="../reference/">Reference</a></li>
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-intro/">Introduction</a></li>
            
            <li><a href="../02-makefiles/">Makefiles</a></li>
            
            <li><a href="../03-variables/">Automatic Variables</a></li>
            
            <li><a href="../04-dependencies/">Dependencies on Data and Code</a></li>
            
            <li><a href="../05-patterns/">Pattern Rules</a></li>
            
            <li><a href="../06-variables/">Variables</a></li>
            
            <li><a href="../07-functions/">Functions</a></li>
            
            <li><a href="../08-self-doc/">Self-Documenting Makefiles</a></li>
            
            <li><a href="../09-conclusion/">Conclusion</a></li>
            
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../extras/discuss.html">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../license/">License</a></li>
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>





<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../05-patterns/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h3 class="maintitle"><a href="../">Automation and Make</a></h3>
    <h1 class="maintitle">Variables</h1>
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../07-functions/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 15 min
      <br/>
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I eliminate redundancy in my Makefiles?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Use variables in a Makefile.</p>
</li>
	
	<li><p>Explain the benefits of decoupling configuration from computation.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Despite our efforts, our Makefile still has repeated content, namely
the name of our script, <code class="highlighter-rouge">wordcount.py</code>. If we renamed our script weâ€™d
have to update our Makefile in multiple places.</p>

<p>We can introduce a Make <a href="../reference/#variable">variable</a> (called a
<a href="../reference/#macro">macro</a> in some versions of Make) to hold our
script name:</p>

<div class="make highlighter-rouge"><pre class="highlight"><code>COUNT_SRC=wordcount.py
</code></pre>
</div>

<p>This is a variable <a href="../reference/#assignment">assignment</a> -
<code class="highlighter-rouge">COUNT_SRC</code> is assigned the value <code class="highlighter-rouge">wordcount.py</code>.</p>

<p><code class="highlighter-rouge">wordcount.py</code> is our script and it is invoked by passing it to
<code class="highlighter-rouge">python</code>. We can introduce another variable to represent this
execution:</p>

<div class="make highlighter-rouge"><pre class="highlight"><code>COUNT_EXE=python $(COUNT_SRC)
</code></pre>
</div>

<p><code class="highlighter-rouge">$(...)</code> tells Make to replace a variable with its value when Make
is run. This is a variable <a href="../reference/#reference">reference</a>. At
any place where we want to use the value of a variable we have to
write it, or reference it, in this way.</p>

<p>Here we reference the variable <code class="highlighter-rouge">COUNT_SRC</code>. This tells Make to
replace the variable <code class="highlighter-rouge">COUNT_SRC</code> with its value <code class="highlighter-rouge">wordcount.py</code>. When
Make is run it will assign to <code class="highlighter-rouge">COUNT_EXE</code> the value <code class="highlighter-rouge">python
wordcount.py</code>.</p>

<p>Defining the variable <code class="highlighter-rouge">COUNT_EXE</code> in this way allows us to easily
change how our script is run (if, for example, we changed the language
used to implement our script from Python to R).</p>

<blockquote class="challenge">
  <h2 id="use-variables">Use Variables</h2>

  <p>Update <code class="highlighter-rouge">Makefile</code> so that the <code class="highlighter-rouge">%.dat</code> rule
references the variables <code class="highlighter-rouge">COUNT_SRC</code> and <code class="highlighter-rouge">COUNT_EXE</code>.
Then do the same for the <code class="highlighter-rouge">zipf-test.py</code> script
and the <code class="highlighter-rouge">results.txt</code> rule,
using <code class="highlighter-rouge">ZIPF_SRC</code> and <code class="highlighter-rouge">ZIPF_EXE</code> as variable names</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>
    <p><a href="../code/06-variables-challenge/Makefile">This Makefile</a>
contains a solution to this challenge.</p>
  </blockquote>
</blockquote>

<p>We place variables at the top of a Makefile so they are easy to
find and modify. Alternatively, we can pull them out into a new
file that just holds variable definitions (i.e. delete them from
the original makefile). Let us create <code class="highlighter-rouge">config.mk</code>:</p>

<div class="make highlighter-rouge"><pre class="highlight"><code># Count words script.
COUNT_SRC=wordcount.py
COUNT_EXE=python $(COUNT_SRC)

# Test Zipf's rule
ZIPF_SRC=zipf_test.py
ZIPF_EXE=python $(ZIPF_SRC)
</code></pre>
</div>

<p>We can then import <code class="highlighter-rouge">config.mk</code> into <code class="highlighter-rouge">Makefile</code> using:</p>

<div class="make highlighter-rouge"><pre class="highlight"><code>include config.mk
</code></pre>
</div>

<p>We can re-run Make to see that everything still works:</p>

<div class="bash highlighter-rouge"><pre class="highlight"><code>$ make clean
$ make dats
$ make results.txt
</code></pre>
</div>

<p>We have separated the configuration of our Makefile from its rules,
the parts that do all the work. If we want to change our script name
or how it is executed we just need to edit our configuration file, not
our source code in <code class="highlighter-rouge">Makefile</code>. Decoupling code from configuration in
this way is good programming practice, as it promotes more modular,
flexible and reusable code.</p>

<blockquote class="callout">
  <h2 id="where-we-are">Where We Are</h2>

  <p><a href="../code/06-variables/Makefile">This Makefile</a>
and <a href="../code/06-variables/config.mk">its accompanying <code class="highlighter-rouge">config.mk</code></a>
contain all of our work so far.</p>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Define variables by assigning values to names.</p>
</li>
    
    <li><p>Reference variables using <code class="highlighter-rouge">$(...)</code>.</p>
</li>
    
  </ul>
</blockquote>





<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../05-patterns/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../07-functions/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      <footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016
	<a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="mailto:lessons@software-carpentry.org">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    <script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
